---
title: "Capital Budget Funding in Toronto"
subtitle: "An Analysis of the Funding Disparties Across Toronto Wards (2022 - 2031)"
author: Maria Mangru 
thanks: "Code and data are available at: https://github.com/MariaMangru/Capital-Budget-Allocations-and-Median-Household-Income."
date: today
date-format: long
abstract: "This study examines the allocation of capital funding across Toronto's 25 wards from 2022 to 2031, focusing on its relationship with key socioeconomic factors. The results found that wards with higher median household incomes and greater educational attainment receive more captial funding per capita. Conversely, wards with higher proportions of low-income households and visible minority populations tend to receive less funding per capita."
format: pdf
number-sections: true
bibliography: references.bib
---

# Introduction

Toronto is a city renowned for its cultural diversity, however, it is also a city marked by stark socioeconomic disparities. Each year, Toronto allocates funds through its capital budget to support essential services such as public transit, libraries, parks and water facilities. \[REF: https://www.toronto.ca/wp-content/uploads/2017/11/97f7-A170XXXX_Budget_Basics_Understanding-final-web.pdf\]. This funding shapes the city's infrastructure and directly impacts residents' quality of life and access to opportunities.

Despite Toronto's commitment to equity, evidence suggests that wealthier neighborhoods receive a disproportionate share of public investment. Previous reports, such as Walks et al. (2016) \[REFERENCE HERE\], highlight how income segregation leads to affluent areas accumulating more resources, while low-income neighborhoods face underfunded services. This pattern enhances socioeconomic disparities and hinders the city's overall progress toward inclusivity.

This research investigates how capital funding from 2022 to 2031 is allocated across Toronto's wards and examines its relationship with median household income, educational attainment, and visible minority populations. By identifying patterns in funding distribution, we aim to understand whether current investment strategies align with the needs of all communities.

The remainder of the research is organized as follows: Section \ref{sec-data} describes the data sources and methodology used in the analysis. Section \ref{sec-results} presents the results, highlighting key findings through visualizations and statistical summaries. Section \ref{sec-discussion} discusses the implications of these findings, addresses limitations, and offers recommendations for further research.

# Data {#sec-data}

## Data Sources

This study utilizes two primary datasets provided by the City of Toronto's Open Data Portal.

1.  Capital Budget & Plan By Ward (2022-2031):

This dataset provides detailed funding allocations for each of Toronto's 25 wards over a ten-year period It covers various programs such as Children's Services, Parks, Forestry & Recreation, and Transportation Services.

2.  Ward Profiles (2021):

This dataset provides comprehensive socioeconomic information based on the 2021 census, including total population, median household income, prevalence of low-income households, educational attainment, and visible minority populations.

These datasets were merged in order to link capital funding allocations with socioeconomic indicators at the ward level. The analysis for this paper was conducted using R (REFERENCE), with several packages from the tidyverse suite (REFERENCE WICKHAM ETA) being used for data cleaning, manipulation and visualization. Visualizations were created using ggplot2, and tables were rendered using kableExtra.

```{r setting up workspace, echo=FALSE, message=FALSE, warning=FALSE}
#### Workspace setup ####
library(dplyr)
library(tidyr)
library(readr)
library(knitr)
library(kableExtra)
library(scales)
library(ggplot2)
library(stringr)
library(janitor)


### Data Handling ###

# Read in the cleaned budget data
budget_data <- read_csv("../data/analysis_data/clean_budget_data.csv")

# Read in the cleaned demographic data
demographic_data <- read_csv("../data/analysis_data/clean_ward_demo_data.csv")

# Identify year columns in budget data
year_cols <- as.character(2022:2031)

# Aggregate total funding per ward number
total_funding_ward <- budget_data |>
  group_by(`Ward Number`)|>
  summarise(
    total_funding = sum(across(all_of(year_cols)), na.rm = TRUE)
  ) |>
  arrange(desc(total_funding))

# Adjust total funding (amounts are in thousands of dollars)
total_funding_ward <- total_funding_ward |>
  mutate(total_funding = total_funding * 1000)

# Pivot demographic data from wide to long format
demographic_long <- demographic_data |>
  pivot_longer(
    cols = -category,
    names_to = "Ward Number",
    values_to = "Value"
  )

# Pivot demographic data back to wide format to get one row per ward
demographic_wide <- demographic_long |>
  pivot_wider(
    names_from = category,
    values_from = Value
  )

# Convert 'Ward Number' to numeric in both datasets to allow merging
total_funding_ward$`Ward Number` <- as.numeric(as.character(total_funding_ward$`Ward Number`))
demographic_wide$`Ward Number` <- as.numeric(as.character(demographic_wide$`Ward Number`))

# Merge budget data with demographic data
merged_data <- total_funding_ward |>
  left_join(demographic_wide, by = "Ward Number")

# Convert 'Total Population' to numeric
merged_data$`Total Population` <- as.numeric(gsub(",", "", merged_data$`Total Population`))


# Create per capita funding variable
merged_data <- merged_data |>
  mutate(per_capita_funding = total_funding / `Total Population`)


# Convert columns from list to double 
merged_data$`Bachelor’s degree or higher` <- as.numeric(merged_data$`Bachelor’s degree or higher`)
merged_data$`Total visible minority population` <- as.numeric(merged_data$`Total visible minority population`)


#Create per capita bachelor's degree variable
merged_data <- merged_data |>
  mutate(`Bachelor’s degree or higher per capita` = `Bachelor’s degree or higher` / `Total Population`)


#Create per capita visible minority population variable
merged_data <- merged_data |>
  mutate(`Total visible minority population per capita` = `Total visible minority population` / `Total Population`)

```

## Data Preparation

This research focused on ward-specific funding by excluding "City Wide" allocations that are not tied to particular wards. The per capita funding was calculated by dividing each ward's total funding by its population. Similarly, the variables `Educational Attainment` and `Visible Minority Population` were were expressed as percentages by dividing each variable by the ward's population. This was done to standardized the variables allowing the comparison across wards.

The key variables of interest for this research are:

-   Per Capita Funding: Total capital funding allocated to a ward divided by its population.

-   Median Household Income: The median income of households within a ward.

-   Low-Income Prevalence: The percentage of households classified as low-income in a ward.

-   Educational Attainment: The percentage of residents with a bachelor's degree or higher.

-   Visible Minority Population: The percentage of residents who identify as visible minorities.

```{r summary-stats-table, echo=FALSE, message=FALSE, warning=FALSE}
#| label: tbl-demographics-stats
#| tbl-cap: Table Showing Capital Funding and Socioeconomic Indicators by Ward


# Select relevant columns for the table
merged_table_select <- merged_data |>
  select(
    `Ward Number`,
    per_capita_funding,
    `Median total income of households in 2020 ($)`,
    `Prevalence of low income based on the Low-income measure, after tax (LIM-AT) (%)`,
    `Bachelor’s degree or higher per capita`,
    `Total visible minority population per capita`
  )

# Arrange by the numeric version of per capita funding before formatting
merged_table_select <- merged_table_select |>
  arrange(desc(per_capita_funding))

# Format numeric columns with conditional formatting for LaTeX
merged_table_2 <- merged_table_select |>
  mutate(
    # Format Per Capita Funding as dollars
    per_capita_funding = dollar(per_capita_funding),
    `Median total income of households in 2020 ($)` = paste0(dollar(as.numeric(`Median total income of households in 2020 ($)`))),
    `Prevalence of low income based on the Low-income measure, after tax (LIM-AT) (%)` = paste0(round(as.numeric(`Prevalence of low income based on the Low-income measure, after tax (LIM-AT) (%)`) * 100, 2), "%"),
    `Bachelor’s degree or higher per capita` = paste0(round(as.numeric(`Bachelor’s degree or higher per capita`) * 100, 2), "%"),
    `Total visible minority population per capita` = paste0(round(as.numeric(`Total visible minority population per capita`) * 100, 2), "%")
  )

# Create the table with kable and apply enhanced styling
kable(
  merged_table_2, 
  escape = TRUE,                   
  col.names = c(
    "Ward Number", 
    "Per Capita Funding", 
    "Household Median Income", 
    "Low Income Prevalence", 
    "Bachelor’s Degree or Higher", 
    "Visible Minority Population"
  )
) |>
  kable_styling(
    bootstrap_options = c("condensed"),  
    full_width = FALSE,  
    position = "left",  
    font_size = 7 
  ) |>
  add_footnote("Rows in red indicate a ward where the Household Median Income is $84,000 or less", notation="alphabet") |>
  column_spec(1, width = "2cm") |>
  column_spec(2:3, width = "3cm") |>
  column_spec(4, width = "2cm") |>
  column_spec(5:6, width = "3cm") |>
  row_spec(1, color = "red") |>
  row_spec(6, color = "red") |>
  row_spec(9:10, color = "red") |>
  row_spec(13:14, color = "red") |>
  row_spec(17:19, color = "red") |>
  row_spec(21:24, color = "red")
```

Rows in **red** indicate a **Household Median Income** of \$84,000 or less.

@tbl-demographics-stats shows the ward specific funding and key demographic indicators. Ward 13 stands out with the highest per capita funding and a high percentage of low income prevalence, relative to other wards. 


\newpage

```{r Figure 1, echo=FALSE, message=FALSE, warning=FALSE}
#| label: fig-percapitafunding
#| fig-cap: Box plot showing Per Capita Capital Funding by Ward

# Wards by Per Capita Funding
ggplot(merged_data, aes(x = reorder(`Ward Number`, per_capita_funding), y = per_capita_funding)) +
  geom_bar(stat = "identity", fill = "#0072B2") +
  labs(
    title = "Wards by Per Capita Funding",
    x = "Ward Number",
    y = "Per Capita Funding ($CAD)"
  ) +
  scale_y_continuous(labels = dollar_format()) +
  theme_minimal(base_family = "Helvetica") +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    axis.text.x = element_text(angle = 45, hjust = 1, size = 12),
    axis.title = element_text(size = 14)
  )
```

@fig-percapitafunding gives a visual representation of the per capita funding allocated to each ward. This per capita funding varied widely, ranging from \$173.22 in Ward 15 to \$7,674.47 in Ward 13. This significant variation indicates an uneven distribution of resources which may not align with the needs of all communities. 


# Results {#sec-results}

## Per Capita Funding and Household Median Income

The average income across wards is \$84,000, meaning half of the wards have median incomes at or below this amount. Higher income wards will be categorized as one with a median household income above \$84,000. 
A positive relationship was observed between per capita funding and median household income as wards above the citywide average \$84,000 generally received more funding per capita. Specifically, among the top five wards in per capita funding, four have median incomes above \$84,000. However, among the bottom five wards, four have median incomes below \$84,000. 

More specifically, Ward 2, with a high median income of \$100,000, received the second-highest per capita funding at \$4,166.43. In contrast, Ward 22, which has a lower median income of \$77,000, received the second-lowest per capita funding at just \$192.44. This pattern suggests that wealthier wards benefit more from capital investments.


```{r Figure 2, echo=FALSE, message=FALSE, warning=FALSE}
#| label: fig-householdincome
#| fig-cap: Scatter plot illustrating the relationship between Per Capita Funding and Median Household Income

# Scatter plot of Per Capita Funding vs Median Household Income with ward 13 removed 

filtered_data <- merged_data |>
  filter(`Ward Number` != 13)

ggplot(filtered_data, aes(x = as.numeric(`Median total income of households in 2020 ($)`), y = per_capita_funding)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(
    title = "Per Capita Funding vs Median Household Income",
    x = "Median Household Income ($)",
    y = "Per Capita Funding ($)"
  ) +
  scale_x_continuous(labels = dollar_format()) +
  scale_y_continuous(labels = dollar_format()) +
  theme_minimal()
```

@fig-householdincome shows the relationship between the variables, with Ward 13 excluded from the analysis due to its disproportionate impact, which distorts the overall data and does not provide an accurate depiction of the relationship. The upward trend line indicates a positive relationship between per capita funding and median household income. In other words, as median household income rises, per capita funding tends to increase as well.


## Per Capita Funding and Low-Income Prevalence

Analyzing the prevalence of low-income households provides additional insight into funding disparities. Wards with higher percentages of low-income households often receive less per capita funding. A ward is defined as having a higher percentage of low income households if the low income prevalence is 13% or higher. Therefore, of the top 5 wards for per capita funding, two are classified as low income. Conversely, of the bottom 5 wards for per capita funding, four are classified as low income.

**Figure 2** demonstrates a downward trend, suggesting that as the prevalence of low-income households increases, per capita funding tends to decrease. This inverse relationship raises concerns about the equitable distribution of city resources.

```{r Figure 3, echo=FALSE, message=FALSE, warning=FALSE}
#| label: fig-lowincome

# Scatter plot of Per Capita Funding vs Prevalence of low income with ward 13 removed 

filtered_data <- merged_data |>
  filter(`Ward Number` != 13)

ggplot(filtered_data, aes(x = as.numeric(`Prevalence of low income based on the Low-income measure, after tax (LIM-AT) (%)`), y = per_capita_funding)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(
    title = "Per Capita Funding vs Prevalence of low income",
    x = "Prevalence of low income (%)",
    y = "Per Capita Funding ($)"
  ) +
  scale_x_continuous(labels = percent_format()) +
  scale_y_continuous(labels = dollar_format()) +
  theme_minimal()
```





## Per Capita Funding and Educational Attainment

Educational attainment appears to have a strong positive relationship with funding allocations. Wards where a higher percentage of residents hold a bachelor's degree or higher tend to receive more per capita funding. A higher percentage of residents holding a bachelor's degree or higher is defined as a 33%. Notable examples include:

-   **Ward 10**, where **60.97%** of residents have at least a bachelor's degree, receives **\$4,127.10** per capita, the second highest per capita funding.
-   **Ward 11**, with **56.07%** of residents holding a bachelor's degree or higher, receives **\$1,637.81** per capita.
-   Conversely, **Ward 7**, with only **14.67%** educational attainment at this level, receives **\$852.05** per capita.

**Figure 3** shows a clear upward trend, indicating that higher educational attainment within a ward is associated with increased capital funding per capita.

```{r Figure 4, echo=FALSE, message=FALSE, warning=FALSE}
#| label: fig-education

# Scatter plot of Per Capita Funding vs Bachelor's Degree of Higher with ward 13 removed 

filtered_data <- merged_data |>
  filter(`Ward Number` != 13)

ggplot(filtered_data, aes(x = as.numeric(`Bachelor’s degree or higher per capita`), y = per_capita_funding)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(
    title = "Per Capita Funding vs Bachelor's degree or higher",
    x = "Attained Bachelor's degree or higher (%)",
    y = "Per Capita Funding ($)"
  ) +
  scale_x_continuous(labels = percent_format()) +
  scale_y_continuous(labels = dollar_format()) +
  theme_minimal()
```

## Per Capita Funding and Visible Minority Population

The relationship between per capita funding and the percentage of visible minority populations is complex. Some wards with higher percentages of visible minorities receive lower per capita funding. A higher percentage of visible minorities is defined as 57% or more.

Of the top 10 per capita funded wards, 4 have a higher percentage of visible minorities. While for the 10 lowest per capita funded, 6 have a higher percentage of visible minorities. More specifically:

-   **Ward 22** has a visible minority population of **82.31%** and receives **\$192.44** per capita. This is the 2nd lowest per capita funding.
-   **Ward 23**, with a visible minority population of **92.18%**, receives **\$1,829.15** per capita.
-   In contrast, **Ward 2**, with a visible minority population of **31.75%**, receives **\$4,166.43** per capita.

**Figure 4** suggests a slight negative relationship, where wards with higher visible minority populations may receive less funding per capita. However, the relationship is not as pronounced as with other socioeconomic indicators, indicating that additional factors may be at play.

```{r Figure 5, echo=FALSE, message=FALSE, warning=FALSE}
#| label: fig-minority

# Scatter plot of Per Capita Funding vs Minority Population with ward 13 removed 

filtered_data <- merged_data |>
  filter(`Ward Number` != 13)

ggplot(filtered_data, aes(x = as.numeric(`Total visible minority population per capita`), y = per_capita_funding)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(
    title = "Per Capita Funding vs Visible Minority Population",
    x = "Visible Minority Population (%)",
    y = "Per Capita Funding ($)"
  ) +
  scale_x_continuous(labels = percent_format()) +
  scale_y_continuous(labels = dollar_format()) +
  theme_minimal()
```

There are outliers such as Ward 23, where 92.18% of residents are visible minorities, yet the ward receives \$1,829.15 per capita. However, the general trend suggests that wards with larger visible minority populations tend to receive less funding overall, raising concerns about whether capital funding is being equitably distributed in alignment with the needs of these communities.

# Discussion {#sec-discussion}

## First discussion point {#sec-first-point}

## Second discussion point

## Third discussion point

## Weaknesses and next steps

\newpage

# References
