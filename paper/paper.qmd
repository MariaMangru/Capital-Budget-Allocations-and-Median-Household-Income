---
title: "Capital Budget Funding in Toronto"
subtitle: "An Analysis of the Funding Disparties Across Toronto Wards (2022 - 2031)"
author: Maria Mangru 
thanks: "Code and data are available at: https://github.com/MariaMangru/Capital-Budget-Allocations-and-Median-Household-Income."
date: today
date-format: long
abstract: "This research examines the allocation of capital funding across Toronto's 25 wards from 2022 to 2031, examining its relationship with socioeconomic indicators. The results reveal significant disparities in per capita funding, with higher-income wards and those with higher educational attainment receiving disproportionately more investment. Conversely, wards with higher proportions of low-income households and visible minority populations receive less funding per capita."
format: pdf
number-sections: true
bibliography: references.bib
---

# Introduction

Toronto, often referred to as a cultural mosaic, is home to a diverse population with roots from all around the world. It is also city where its neighbourhoods vary significantly in income, educational attainment, and demographic makeup. The allocation of capital funding plays a crucial role in developing infrastructure and services which directly impact residents' quality of life and access to opportunities. Equitable distribution of these funds is essential to ensure that all communities within the city can thrive.

Despite the city's commitment to equity, recent studies have raised concerns about the fairness of budget distributions. Research by Walks et al. (2016) **\[REFERENCE THIS\]** highlights growing income inequality in Toronto's neighborhoods, noting a trend toward the spatial concentration of wealth and poverty. Similarly, PAPER HERE **\[REFERENCE THIS\]** WHAT IT TALKED ABOUT.

\[https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8186789/ , http://neighbourhoodchange.ca/documents/2016/05/walks-etal-2016-income-inequality-toronto-york-rp-238.pdf\]

By analyzing data from the City of Toronto's Capital Budget & Plan and Ward Profiles, the study uncovers significant disparities in per capita funding. Notably, higher-income wards and those with higher educational attainment tend to receive more funding per capita than lower-income wards, suggesting a potential misalignment with the needs of less affluent communities.

The remainder of the research is organized as follows: Section \ref{sec-data} describes the data sources and methodology used in the analysis. Section \ref{sec-results} presents the results, highlighting key findings through visualizations and statistical summaries. Section \ref{sec-discussion} discusses the implications of these findings, addresses limitations, and offers recommendations for improvements to this research.

# Data {#sec-data}

## Data Sources

This research utilized two primary datasets provided by the City of Toronto's Open Data Portal.

1.  Capital Budget & Plan By Ward (2022-2031):

This dataset contains the approved capital budget and plan for each of Toronto's 25 wards over a ten-year period from 2022 to 2031. It includes funding allocations for various programs such as Children's Services, Parks, Foresty & Recreation, Transportation Services, and others. The data provides a detailed breakdown of how much funding each ward is set to receive for specific projects and services.

2.  Ward Profiles (2021):

This dataset provides comprehensive socioeconomic information for each ward based on the 2021 census. It was filtered to remain the variables which were most useful for this research. These are: Total Population, Median Household Income, Prevalence of Low Income Households, Educational Attainment, Immigration Status, Visible Minority Population. **\[UPDATE THIS\]**

```{r setting up workspace, echo=FALSE, message=FALSE, warning=FALSE}
#### Workspace setup ####
library(dplyr)
library(tidyr)
library(readr)
library(knitr)
library(kableExtra)
library(scales)
library(ggplot2)
library(stringr)
library(janitor)


### Data Handling ###

# Read in the cleaned budget data
budget_data <- read_csv("../data/analysis_data/clean_budget_data.csv")

# Read in the cleaned demographic data
demographic_data <- read_csv("../data/analysis_data/clean_ward_demo_data.csv")

# Identify year columns in budget data
year_cols <- as.character(2022:2031)

# Aggregate total funding per ward number
total_funding_ward <- budget_data |>
  group_by(`Ward Number`)|>
  summarise(
    total_funding = sum(across(all_of(year_cols)), na.rm = TRUE)
  ) |>
  arrange(desc(total_funding))

# Adjust total funding (amounts are in thousands of dollars)
total_funding_ward <- total_funding_ward |>
  mutate(total_funding = total_funding * 1000)

# Pivot demographic data from wide to long format
demographic_long <- demographic_data |>
  pivot_longer(
    cols = -category,
    names_to = "Ward Number",
    values_to = "Value"
  )

# Pivot demographic data back to wide format to get one row per ward
demographic_wide <- demographic_long |>
  pivot_wider(
    names_from = category,
    values_from = Value
  )

# Convert 'Ward Number' to numeric in both datasets to allow merging
total_funding_ward$`Ward Number` <- as.numeric(as.character(total_funding_ward$`Ward Number`))
demographic_wide$`Ward Number` <- as.numeric(as.character(demographic_wide$`Ward Number`))

# Merge budget data with demographic data
merged_data <- total_funding_ward |>
  left_join(demographic_wide, by = "Ward Number")

# Convert 'Total Population' to numeric
merged_data$`Total Population` <- as.numeric(gsub(",", "", merged_data$`Total Population`))


# Create per capita funding variable
merged_data <- merged_data |>
  mutate(per_capita_funding = total_funding / `Total Population`)


# Convert columns from list to double 
merged_data$`Bachelor’s degree or higher` <- as.numeric(merged_data$`Bachelor’s degree or higher`)
merged_data$`Total visible minority population` <- as.numeric(merged_data$`Total visible minority population`)


#Create per capita bachelor's degree variable
merged_data <- merged_data |>
  mutate(`Bachelor’s degree or higher per capita` = `Bachelor’s degree or higher` / `Total Population`)


#Create per capita visible minority population variable
merged_data <- merged_data |>
  mutate(`Total visible minority population per capita` = `Total visible minority population` / `Total Population`)

```

## Data Summary

```{r summary-stats-table, echo=FALSE, message=FALSE, warning=FALSE}
#| label: tbl-demographics-stats
#| tbl-cap: Capital Funding and Socioeconomic Indicators by Ward


# Select relevant columns for the table
merged_table_select <- merged_data |>
  select(
    `Ward Number`,
    per_capita_funding,
    `Median total income of households in 2020 ($)`,
    `Prevalence of low income based on the Low-income measure, after tax (LIM-AT) (%)`,
    `Bachelor’s degree or higher per capita`,
    `Total visible minority population per capita`
  )

# Arrange by the numeric version of per capita funding before formatting
merged_table_select <- merged_table_select |>
  arrange(desc(per_capita_funding))

# Format numeric columns with conditional formatting for LaTeX
merged_table_2 <- merged_table_select |>
  mutate(
    # Format Per Capita Funding as dollars
    per_capita_funding = dollar(per_capita_funding),
    `Median total income of households in 2020 ($)` = paste0(dollar(as.numeric(`Median total income of households in 2020 ($)`))),
    `Prevalence of low income based on the Low-income measure, after tax (LIM-AT) (%)` = paste0(round(as.numeric(`Prevalence of low income based on the Low-income measure, after tax (LIM-AT) (%)`) * 100, 2), "%"),
    `Bachelor’s degree or higher per capita` = paste0(round(as.numeric(`Bachelor’s degree or higher per capita`) * 100, 2), "%"),
    `Total visible minority population per capita` = paste0(round(as.numeric(`Total visible minority population per capita`) * 100, 2), "%")
  )

# Create the table with kable and apply enhanced styling
kable(
  merged_table_2, 
  escape = TRUE,                   
  col.names = c(
    "Ward Number", 
    "Per Capita Funding", 
    "Household Median Income", 
    "Low Income Prevalence", 
    "Bachelor’s Degree or Higher", 
    "Visible Minority Population"
  )
) |>
  kable_styling(
    bootstrap_options = c("condensed"),  
    full_width = FALSE,  
    position = "left",  
    font_size = 7 
  ) |>
  add_footnote("Rows in red indicate a ward where the Household Median Income is $84,000 or less", notation="alphabet") |>
  column_spec(1, width = "2cm") |>
  column_spec(2:3, width = "3cm") |>
  column_spec(4, width = "2cm") |>
  column_spec(5:6, width = "3cm") |>
  row_spec(1, color = "red") |>
  row_spec(6, color = "red") |>
  row_spec(9:10, color = "red") |>
  row_spec(13:14, color = "red") |>
  row_spec(17:19, color = "red") |>
  row_spec(21:24, color = "red")
```

Rows in **red** indicate a **Household Median Income** of \$84,000 or less.


```{r Figure 1, echo=FALSE, message=FALSE, warning=FALSE}
#| label: fig-percapitafunding
# Wards by Per Capita Funding
ggplot(merged_data, aes(x = reorder(`Ward Number`, per_capita_funding), y = per_capita_funding)) +
  geom_bar(stat = "identity", fill = "#0072B2") +
  labs(
    title = "Wards by Per Capita Funding",
    x = "Ward Number",
    y = "Per Capita Funding ($CAD)"
  ) +
  scale_y_continuous(labels = dollar_format()) +
  theme_minimal(base_family = "Helvetica") +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    axis.text.x = element_text(angle = 45, hjust = 1, size = 12),
    axis.title = element_text(size = 14)
  )
```

# Results {#sec-results}

Exploring the data reveals substantial disparities in per capita capital funding across Toronto's 25 wards. The per capita funding ranges dramatically, from as low as 173.22 in Ward 15 to as high as 7,674.47 in Ward 13. This significant variation suggests that capital investment is not evenly distributed among the city's wards, prompting questions about the factors influencing these allocations.

## Per Capita Funding and Household Median Income

When comparing per capita funding to household median income, a pattern emerges that suggests a positive relationship between the two variables. Wards with higher median household incomes tend to receive more capital funding per capita. For instance:

-   **Ward 2** has a household median income of **\$100,000** and receives **\$4,166.43** per capita in funding.
-   **Ward 10**, with a median income of **\$89,000**, receives **\$4,127.10** per capita.
-   Conversely, **Ward 22**, with a lower median income of **\$77,000**, receives only **\$192.44** per capita.

**Figure 1** illustrates this relationship, showing a general upward trend. While there are exceptions—such as **Ward 13**, which has a median income of **\$65,000** but the highest per capita funding—the overall pattern indicates that wealthier wards receive more capital investment.


```{r Figure 2, echo=FALSE, message=FALSE, warning=FALSE}
#| label: fig-householdincome

# Scatter plot of Per Capita Funding vs Median Household Income with ward 13 removed 

filtered_data <- merged_data |>
  filter(`Ward Number` != 13)

ggplot(filtered_data, aes(x = as.numeric(`Median total income of households in 2020 ($)`), y = per_capita_funding)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(
    title = "Per Capita Funding vs Median Household Income",
    x = "Median Household Income ($)",
    y = "Per Capita Funding ($)"
  ) +
  scale_x_continuous(labels = dollar_format()) +
  scale_y_continuous(labels = dollar_format()) +
  theme_minimal()
```







## Per Capita Funding and Low-Income Prevalence

Analyzing the prevalence of low-income households provides additional insight into funding disparities. Wards with higher percentages of low-income households often receive less per capita funding. For example:

-   **Ward 22** has a low-income prevalence of **15%** and receives **\$192.44** per capita.
-   **Ward 5**, with **15%** low-income prevalence, receives **\$867.02** per capita.
-   In contrast, **Ward 2** has a low-income prevalence of **8%** and receives **\$4,166.43** per capita.

**Figure 2** demonstrates a downward trend, suggesting that as the prevalence of low-income households increases, per capita funding tends to decrease. This inverse relationship raises concerns about the equitable distribution of city resources.

```{r Figure 3, echo=FALSE, message=FALSE, warning=FALSE}
#| label: fig-lowincome

# Scatter plot of Per Capita Funding vs Prevalence of low income with ward 13 removed 

filtered_data <- merged_data |>
  filter(`Ward Number` != 13)

ggplot(filtered_data, aes(x = as.numeric(`Prevalence of low income based on the Low-income measure, after tax (LIM-AT) (%)`), y = per_capita_funding)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(
    title = "Per Capita Funding vs Prevalence of low income",
    x = "Prevalence of low income (%)",
    y = "Per Capita Funding ($)"
  ) +
  scale_x_continuous(labels = percent_format()) +
  scale_y_continuous(labels = dollar_format()) +
  theme_minimal()
```

## Per Capita Funding and Educational Attainment

Educational attainment appears to correlate strongly with funding allocations. Wards where a higher percentage of residents hold a bachelor's degree or higher tend to receive more per capita funding. Notable examples include:

-   **Ward 10**, where **60.97%** of residents have at least a bachelor's degree, receives **\$4,127.10** per capita.
-   **Ward 11**, with **56.07%** of residents holding a bachelor's degree or higher, receives **\$1,637.81** per capita.
-   Conversely, **Ward 7**, with only **14.67%** educational attainment at this level, receives **\$852.05** per capita.

**Figure 3** shows a clear upward trend, indicating that higher educational attainment within a ward is associated with increased capital funding per capita.

```{r Figure 4, echo=FALSE, message=FALSE, warning=FALSE}
#| label: fig-education

# Scatter plot of Per Capita Funding vs Bachelor's Degree of Higher with ward 13 removed 

filtered_data <- merged_data |>
  filter(`Ward Number` != 13)

ggplot(filtered_data, aes(x = as.numeric(`Bachelor’s degree or higher per capita`), y = per_capita_funding)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(
    title = "Per Capita Funding vs Bachelor's degree or higher",
    x = "Attained Bachelor's degree or higher (%)",
    y = "Per Capita Funding ($)"
  ) +
  scale_x_continuous(labels = percent_format()) +
  scale_y_continuous(labels = dollar_format()) +
  theme_minimal()
```


## Per Capita Funding and Visible Minority Population

The relationship between per capita funding and the percentage of visible minority populations is complex. Some wards with higher percentages of visible minorities receive lower per capita funding. For instance:

-   **Ward 22** has a visible minority population of **82.31%** and receives **\$192.44** per capita.
-   **Ward 23**, with a visible minority population of **92.18%**, receives **\$1,829.15** per capita.
-   In contrast, **Ward 2**, with a visible minority population of **31.75%**, receives **\$4,166.43** per capita.

**Figure 4** suggests a slight negative correlation, where wards with higher visible minority populations may receive less funding per capita. However, the relationship is not as pronounced as with other socioeconomic indicators, indicating that additional factors may be at play.

```{r Figure 5, echo=FALSE, message=FALSE, warning=FALSE}
#| label: fig-minority

# Scatter plot of Per Capita Funding vs Minority Population with ward 13 removed 

filtered_data <- merged_data |>
  filter(`Ward Number` != 13)

ggplot(filtered_data, aes(x = as.numeric(`Total visible minority population per capita`), y = per_capita_funding)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(
    title = "Per Capita Funding vs Visible Minority Population",
    x = "Visible Minority Population (%)",
    y = "Per Capita Funding ($)"
  ) +
  scale_x_continuous(labels = percent_format()) +
  scale_y_continuous(labels = dollar_format()) +
  theme_minimal()
```


While general trends are observed, outliers like Ward 13 challenge simple interpretations. Despite having a lower median household income and higher low-income prevalence, it receives the highest per capita funding. This anomaly suggests that specific projects or unique circumstances, such as major infrastructure developments or targeted investments, can significantly impact funding levels in certain wards.

RESULTS NEED A LOT OF FIXING. THERE IS SOME REDUNDENCY. MAYBE A LOT LOL

# Discussion {#sec-discussion}

## First discussion point {#sec-first-point}

## Second discussion point

## Third discussion point

## Weaknesses and next steps

\newpage

# References
